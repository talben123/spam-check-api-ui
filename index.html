<script>
  async function checkPhone() {
    const phone = document.getElementById("phone").value.trim();
    if (!phone) return;

    const res = await fetch(`https://phonescamchecker.talben123.workers.dev?phone=${encodeURIComponent(phone)}`);
    const data = await res.json();

    const html = `
      <strong>📊 Risk Level:</strong> ${data.risk_level}<br>
      <strong>🗂 Reports:</strong> ${data.reports}<br>
      <strong>📁 Category:</strong> ${data.category}<br>
      <strong>🌍 Country:</strong> ${data.country}<br>
      <strong>🔗 Links:</strong><br>
      <a href="${data.enrichment.social_links.truecaller}" target="_blank">Truecaller</a> |
      <a href="${data.enrichment.social_links.whatsapp}" target="_blank">WhatsApp</a> |
      <a href="${data.enrichment.social_links.telegram}" target="_blank">Telegram</a><br><br>
      <strong>✅ Recommendation:</strong> ${
        data.recommendation.includes("http")
          ? `<a href="${data.recommendation}" target="_blank">Take Action</a>`
          : data.recommendation
      }
    `;

    document.getElementById("result").innerHTML = html;
    document.getElementById("result").style.display = "block";

    // Show feedback buttons
    document.getElementById("feedback").style.display = "block";

    // Ping affiliate CPC
    document.getElementById("ping").src = "https://your-propellerads-smartlink.com";
  }

  function openAffiliate() {
    const win = window.open("https://your-propellerads-smartlink.com", "_blank");
    if (win) {
      win.focus();
    } else {
      alert("Please allow popups to view protection tools.");
    }
  }

  function sendFeedback(isCorrect) {
    const phone = document.getElementById("phone").value.trim();
    const feedbackData = {
      phone,
      correct: isCorrect,
      timestamp: new Date().toISOString()
    };

    fetch("https://your-feedback-endpoint.com", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(feedbackData)
    }).then(() => {
      alert("Thanks for your feedback! 🙏");
      document.getElementById("feedback").style.display = "none";
    });
  }
</script>
