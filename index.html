<script>
  async function checkPhone() {
    const phone = document.getElementById("phone").value.trim();
    if (!phone) return;

    try {
      const res = await fetch(`https://phonescamchecker.talben123.workers.dev?phone=${encodeURIComponent(phone)}`);
      const data = await res.json();

      const truecaller = data?.enrichment?.social_links?.truecaller || "#";
      const whatsapp = data?.enrichment?.social_links?.whatsapp || "#";
      const telegram = data?.enrichment?.social_links?.telegram || "#";
      const recommendation = data?.recommendation || "Use caution.";

      const html = `
        <strong>📊 Risk Level:</strong> ${data.risk_level || "Unknown"}<br>
        <strong>🗂 Reports:</strong> ${data.reports ?? "N/A"}<br>
        <strong>📁 Category:</strong> ${data.category || "Unknown"}<br>
        <strong>🌍 Country:</strong> ${data.country || "Unknown"}<br>
        <strong>🔗 Links:</strong><br>
        <a href="${truecaller}" target="_blank">Truecaller</a> |
        <a href="${whatsapp}" target="_blank">WhatsApp</a> |
        <a href="${telegram}" target="_blank">Telegram</a><br><br>
        <strong>✅ Recommendation:</strong> ${
          recommendation.startsWith("http")
            ? `<a href="${recommendation}" target="_blank">Take Action</a>`
            : recommendation
        }
      `;

      document.getElementById("result").innerHTML = html;
      document.getElementById("result").style.display = "block";
      document.getElementById("feedback").style.display = "block";
      document.getElementById("ping").src = "https://your-propellerads-smartlink.com";

    } catch (error) {
      document.getElementById("result").innerHTML = "❌ Error loading data. Please try again.";
      document.getElementById("result").style.display = "block";
      console.error("API Error:", error);
    }
  }

  function openAffiliate() {
    const win = window.open("https://your-propellerads-smartlink.com", "_blank");
    if (win) {
      win.focus();
    } else {
      alert("Please allow popups to view protection tools.");
    }
  }

  function sendFeedback(isCorrect) {
    const phone = document.getElementById("phone").value.trim();
    const feedbackData = {
      phone,
      correct: isCorrect,
      timestamp: new Date().toISOString()
    };

    fetch("https://your-feedback-endpoint.com", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(feedbackData)
    }).then(() => {
      alert("Thanks for your feedback! 🙏");
      document.getElementById("feedback").style.display = "none";
    });
  }
</script>
